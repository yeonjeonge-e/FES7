<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>XMLHttpRequest</title>
  <style>

  </style>
</head>

<body>

  <!--
  <script>
    const requestObj = new XMLHttpRequest();
    // XHR 객체를 생성합니다.
    requestObj.open('GET', 'url');
    // 요청을 초기화합니다. 통신방법과 요청을 발신할 대상의 주소를 전달합니다.
    requestObj.onreadystatechange = () => {
      // readystate 가 변화하면 실행되는 이벤트리스너 입니다.
      // readystate : 요청을 보내는 클라이언트의 상태를 의미합니다.

      // readystate의 종류
      // 0 (UNSENT) - XHR 객체가 생성되었지만 아직 초기화되지 않았습니다.
      // 1 (OPENED) - open()함수가 호출되어 요청이 초기화되었습니다.
      // 2 (HEADERS_RECEIVED) - send()함수가 호출되었습니다.
      // 3 (LOADING) - 데이터를 다운받는 중 입니다.
      // 4 (DONE) - 통신이 완료되었습니다.
      if (requestObj.readyState === 4 && requestObj.status === "200") {
        //  status : 서버에서 보내는 상태 값

        const result = requestObj.responseText;

      }
    };
    requestObj.send();
    //  서버로 요청을 보냅니다.
    //  send 메소드가 실행되어야만 우리가 위에서 설정한 내용들이 의미를 가지게 됩니다.
  </script>
-->





  <!-- 버튼을 누르면 데이터를 비동기적으로 가져와 화면에 표시하는 앱을 만들어 보겠습니다. -->
  <!--
  <p>some text</p>
  <button>통신 시작</button>

  <script>
    const btn = document.querySelector('button');
    const txt = document.querySelector('p');
    btn.addEventListener('click', xhrRequest);

    function xhrRequest() {
      const xhrObj = new XMLHttpRequest();
      xhrObj.open('GET', 'message.txt');

      xhrObj.onreadystatechange = () => {
        if (xhrObj.readyState === 4 && xhrObj.status === 200) {
          const result = xhrObj.responseText;
          txt.textContent = result;
        }
      };

      xhrObj.send();
    };
  </script>
-->





  <!-- 앞서 작성한 XHR 코드를 수정해서 확인 -->
  <p>some text</p>
  <button>통신 시작</button>

  <script>
    const btn = document.querySelector('button');
    const txt = document.querySelector('p');

    let result;

    function xhrRequest() {
      const xhrObj = new XMLHttpRequest();
      xhrObj.open('GET', 'message.txt');

      xhrObj.onreadystatechange = () => {
        if (xhrObj.readyState === 4 && xhrObj.status === 200) {
          result = xhrObj.responseText;

          console.log(result);    //  undefined
        }
      };

      xhrObj.send();
    };

    xhrRequest();

    console.log(result);          //  하위 얀둥
  </script>

</body>

</html>